<!DOCTYPE html>
<html>

<head lang="en">
    <title>PR Checks Settings</title>
    <meta charset="utf-8" />
    <script src="sdpi-components.js"></script>
</head>

<body>
    <!-- Profile Selection Section -->
    <sdpi-heading>Azure DevOps Configuration</sdpi-heading>
    
    <sdpi-item label="Configuration Profile">
        <sdpi-select setting="profileId" datasource="getProfiles" placeholder="Select a profile...">
            <option value="">Select Profile...</option>
        </sdpi-select>
    </sdpi-item>
    
    <sdpi-item label="">
        <sdpi-button value="Manage Profiles" onclick="$pi.sendToPlugin({event: 'openConfigManager'})"></sdpi-button>
    </sdpi-item>
    
    <!-- PR Settings Section -->
    <sdpi-heading>Pull Request Settings</sdpi-heading>
    
    <sdpi-item label="Repository">
        <sdpi-select setting="repository" default="all" datasource="getRepositories" loading="Fetching repositories..." placeholder="Please select">
        </sdpi-select>
    </sdpi-item>
    
    <sdpi-item label="Target Branch (Optional)">
        <sdpi-textfield setting="targetBranch" placeholder="main, develop, or refs/heads/main"></sdpi-textfield>
    </sdpi-item>
    
    <!-- Filter Options Section -->
    <sdpi-heading>Filter Options</sdpi-heading>
    
    <sdpi-item label="Show only my PRs">
        <sdpi-checkbox setting="showOnlyMyPRs" default="false"></sdpi-checkbox>
    </sdpi-item>
    
    <sdpi-item label="Show PRs I'm reviewing">
        <sdpi-checkbox setting="showPRsImReviewing" default="false"></sdpi-checkbox>
    </sdpi-item>
    
    <sdpi-item label="Show only PRs with conflicts">
        <sdpi-checkbox setting="showConflictsOnly" default="false"></sdpi-checkbox>
    </sdpi-item>
    
    <!-- Display Options Section -->
    <sdpi-heading>Display Options</sdpi-heading>
    
    <sdpi-item label="Refresh Interval">
        <sdpi-range setting="refreshInterval" min="30" max="300" step="30" default="60" showlabels>
            <span slot="suffix">seconds</span>
        </sdpi-range>
    </sdpi-item>
    
    <sdpi-item label="Display Format">
        <sdpi-select setting="displayFormat" default="both">
            <option value="icon">Icon Only</option>
            <option value="text">Text Only</option>
            <option value="both">Icon and Text</option>
        </sdpi-select>
    </sdpi-item>
    
    <sdpi-item label="Show PR Count">
        <sdpi-checkbox setting="showPRCount" default="true"></sdpi-checkbox>
    </sdpi-item>
    
    <script>
        // Handle messages from plugin
        $pi.onSendToPropertyInspector((jsn) => {
            const payload = jsn.payload;
            
            if (payload.event === 'profileList') {
                // Update profile dropdown
                const select = document.querySelector('[setting="profileId"]');
                if (select && payload.profiles) {
                    // Clear existing options except the first placeholder
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    // Add profile options
                    payload.profiles.forEach(profile => {
                        const option = document.createElement('option');
                        option.value = profile.id;
                        option.text = profile.name + (profile.isDefault ? ' (Default)' : '');
                        select.add(option);
                    });
                }
            }
        });
        
        // Request profiles when Property Inspector loads
        $pi.onConnected((jsn) => {
            $pi.sendToPlugin({ event: 'getProfiles' });
        });
    </script>
</body>

</html>